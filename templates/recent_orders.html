{% extends 'base.html' %}
{% block title %}Recent Orders{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Recent Orders</h3>
  <div>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
  </div>
</div>

<div class="table-responsive">
<table class="table table-striped table-bordered align-middle">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Customer</th>
      <th>Total</th>
      <th>Placed</th>
      <th>Status</th>
      <th>Items</th>
      <th>Manage</th>
    </tr>
  </thead>
  <tbody>
    {% for order in orders %}
    <tr>
      <td>{{ order.id }}</td>
      <td>
        <div><strong>{{ order.customer.name }}</strong></div>
        <div class="text-muted-small">{{ order.customer.email }}</div>
        {% if order.customer.phone %}
        <div class="text-muted-small">{{ order.customer.phone }}</div>
        {% endif %}
      </td>
      <td>₹{{ order.total }}</td>
      <td>{{ order.created_at }}</td>
      <td>
        <form method="post" action="{{ url_for('update_order_status', order_id=order.id) }}" class="d-flex gap-2">
          <select class="form-select form-select-sm" name="status">
            {% for status in order_statuses %}
            <option value="{{ status }}" {% if order.status == status %}selected{% endif %}>{{ status.title() }}</option>
            {% endfor %}
          </select>
          <button class="btn btn-sm btn-outline-primary">Update</button>
        </form>
      </td>
      <td>
        <ul class="mb-0 ps-3 small">
          {% set order_items = order['items'] if order['items'] is not none else [] %}
          {% for item in order_items %}
          <li>{{ item.name }} × {{ item.quantity }}{% if item.size %} ({{ item.size }}){% endif %}</li>
          {% endfor %}
        </ul>
      </td>
      <td>
        <form method="post" action="{{ url_for('delete_order', order_id=order.id) }}" onsubmit="return confirm('Delete this order?')">
          <button class="btn btn-sm btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="7">No orders yet.</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>

{% endblock %}
